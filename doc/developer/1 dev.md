# Подсистема интеграции с внешними системами

# Точки расширения

Архитектура разделена на блоки:
1. Типовая логика, все не Демо модули. Не рекомендуется вносить изменения, например, [модуль интеграции](./3%201%20transport.md).
2. Модифицируемая:
    1. [Инструкция реализации](./2%20demo.md) - примеры для решения типовых прикладных задач.(модули с суффиксом Дем).
    2. [Добавление нового механизма транспорта](./3%202%20new%20transport.md) - опционально
    3. [Сверка полноты и целостности данных](./4%20check%20that%20data%20fine.md) - опционально

## Зависимости решения
- БСП версии 3.0 и старше
- Рекомендуемая версия платформы: 8.3.24.1586 (ведется разработка)
- Разработка в EDT

# Структура подсистемы

## Ключевые элементы

### Справочники
| Имя                                                                   | Назначение                                                                                                                                                   | Пример                                                                                                                                   |
| --------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- |
| **рдв_ВидыСообщенийИнтеграции**                                       | виды сообщений для обмена между системами                                                                                                                    | контрагенты, номенклатура, регистр служебный. Задаем в правилах регистрации см.*см.рдв_МодульИнтеграцииДемо.ЗаполнитьПравилаРегистрации* |
| **рдв_ВнешниеСистемы**                                                | перечень  доступных внешних систем                                                                                                                           | HTTP-сервисы, брокеры сообщений                                                                                                          |
| **рдв_ВыгружаемыеОбъекты**                                            | контейнер для выгружаемых данных (создается автоматически). Любой выгружаемый объект будет связан со справочником, в том числе наборы независимых регистров. |                                                                                                                                          |
| **рдв_СтатусыИнтеграции**, **рдв_ТипыОчередейОбработкиДанных прочие** | вспомогательные справочники                                                                                                                                  |                                                                                                                                          |

### Общие модули

| Модуль                                          | Назначение                                                                                                                                                                                                                         |
| ----------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `рдв_Интеграция`                                | Главный модуль, управляющий процессом интеграции, маршрутизацией сообщений, обработкой отправки и получения данных. Точки входа для регламентных заданий, маршрутизаторы, обработчики ошибок интеграции и вспомогательные функции. |
| `рдв_МенеджерОбмена`                            | Отвечает за правила конвертации данных при обмене между 1С и внешними системами. Содержит функции для инициализации, поиска и добавления правил конвертации объектов и их свойств.                                                 |
| `рдв_РегистрацияИзменений`                      | Модуль для регистрации изменений объектов, подлежащих обмену. Содержит обработчики событий, функции регистрации изменений и вспомогательные процедуры.                                                                             |
| `рдв_ИнтеграцияHTTP`, `рдв_ИнтеграцияRMQ`       | Модули, реализующие работу с конкретными типами внешних систем (HTTP-сервисы, брокеры сообщений RMQ и др.).                                                                                                                        |
| `рдв_...Демо`                                   | Модули с суффиксом Демо содержат примеры прикладной реализации реализации и могут быть использованы как шаблон для разработки новых обработчиков.                                                                                             |
| `рдв_ФормированиеХешейОбъектов`                 | Модуль реализует логику для сверки состояний объектов в разных базах.                                                                                                                                                              |

### Регистры сведений

| Имя                                   | Назначение                                                                                                                                                             |
| ------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `рдв_СообщенияИнтеграции`             | входящие/исходящие сообщения, участвующие в интеграции                                                                                                                 |
| `рдв_КонтекстСообщенийИнтеграции`     | дополнительный контекст сообщений (данные транспорта). Используется для хранения технической информации, полезной для отладки и мониторинга.                           |
| `рдв_ИдентификаторыОбъектовИсточника` | используется для быстрого сопоставления объектов информационных баз. Первый приоритет за регистром, далее ГУИД объекта, далее правила поиска.                          |
| `рдв_ЖурналОчередейОбработкиДанных`   | вспомогательные регистры для управления процессами обмена и идентификации объектов.                                                                                    |
| `рдв_ХешиСообщенийИнтеграции`         | - недопущение выгрузки одного состояния объекта несколько раз. <br>- контроль полноты и целостности данных (настройка ПВХ - ИнтеграцияКонтролироватьЦелостностьДанных) |

### Подписки на события

| Имя                                                                            | Назначение                                         |
| ------------------------------------------------------------------------------ | -------------------------------------------------- |
| `рдв_ДокументыПриЗаписи, рдв_СправочникиПриЗаписи, рдв_НаборыЗаписейПриЗаписи` | регистрация изменений событий обмена               |
| `рдв_ЖурналСобытийПередЗаписьюСообщения, рдв_ЖурналСобытийПриЗаписиОчереди`    | подписки для регистрации событий в процессе обмена |
### Перечисления

| Имя                                                    | Назначение                                                                      |
| ------------------------------------------------------ | ------------------------------------------------------------------------------- |
| `рдв_ТипыВнешнихСистем`                                | типы внешних систем (HTTP, RMQ и др.).                                          |
| `рдв_СтатусыИнтеграции, рдв_СтатусыОбработкиСообщений` | статусы интеграции и обработки сообщений                                        |
| `рдв_ФорматыОбмена, рдв_ТипыВыгружаемыхОбъектов`       | форматы обмена и типы объектов для выгрузки (ссылки, наборы записей, служебные) |
### Обработки

| Имя                          | Назначение                                                               |
| ---------------------------- | ------------------------------------------------------------------------ |
| `рдв_КомпонентаRabbitMQ`     | обработка для работы с RabbitMQ.                                         |
| `рдв_ОбслуживаниеИнтеграции` | обработка для ручной регистрации изменений, пересчета Хеша               |
| `рдв_КонсольЗапросов`        | консоль для регистрации изменений в обработке рдв_ОбслуживаниеИнтеграции |


Далее, [описание процесса регистрации](5%20process%20of%20reg%20of%20changes.md)
